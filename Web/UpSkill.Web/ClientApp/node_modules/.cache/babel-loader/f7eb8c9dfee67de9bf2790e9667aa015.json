{"ast":null,"code":"import axios from \"axios\";\nimport TokenService from \"./tokenService\";\nimport { Base_URL } from \"../utils/baseUrlConstant\";\nimport { logout } from \"../actions/auth\";\nimport { refreshToken } from \"../actions/auth\";\nconst instance = axios.create({\n  baseURL: Base_URL,\n  headers: {\n    \"Content-Type\": \"application/json\"\n  }\n});\ninstance.interceptors.request.use(config => {\n  const token = TokenService.getLocalAccessToken();\n\n  if (token) {\n    config.headers[\"www-authenticate\"] = 'Bearer ' + token;\n  }\n\n  return config;\n}, error => {\n  return Promise.reject(error);\n});\ninstance.interceptors.response.use(res => {\n  return res;\n}, async err => {\n  const originalConfig = err.config;\n\n  if (originalConfig.url !== \"Identity/Login\" && err.response) {\n    // Access Token was expired\n    if (err.response.status === 401 && !originalConfig._retry) {\n      originalConfig._retry = true;\n\n      try {\n        const rs = await instance.post(\"Identity/refreshToken\", {\n          refreshToken: TokenService.getLocalRefreshToken()\n        });\n        const {\n          accessToken\n        } = rs.data;\n        TokenService.updateLocalAccessToken(accessToken);\n        return instance(originalConfig);\n      } catch (_error) {\n        return Promise.reject(_error);\n      }\n    }\n  }\n\n  return Promise.reject(err);\n});\nexport default instance;","map":{"version":3,"sources":["H:/Programming Repositories/Titans/Web/UpSkill.Web/ClientApp/src/services/instance.js"],"names":["axios","TokenService","Base_URL","logout","refreshToken","instance","create","baseURL","headers","interceptors","request","use","config","token","getLocalAccessToken","error","Promise","reject","response","res","err","originalConfig","url","status","_retry","rs","post","getLocalRefreshToken","accessToken","data","updateLocalAccessToken","_error"],"mappings":"AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAOC,YAAP,MAAyB,gBAAzB;AAEA,SAASC,QAAT,QAAyB,0BAAzB;AACA,SAASC,MAAT,QAAuB,iBAAvB;AACA,SAASC,YAAT,QAA6B,iBAA7B;AAEA,MAAMC,QAAQ,GAAGL,KAAK,CAACM,MAAN,CAAa;AAC5BC,EAAAA,OAAO,EAAEL,QADmB;AAE5BM,EAAAA,OAAO,EAAE;AACP,oBAAgB;AADT;AAFmB,CAAb,CAAjB;AAOAH,QAAQ,CAACI,YAAT,CAAsBC,OAAtB,CAA8BC,GAA9B,CACGC,MAAD,IAAY;AACV,QAAMC,KAAK,GAAGZ,YAAY,CAACa,mBAAb,EAAd;;AACA,MAAID,KAAJ,EAAW;AACPD,IAAAA,MAAM,CAACJ,OAAP,CAAe,kBAAf,IAAqC,YAAYK,KAAjD;AACD;;AACD,SAAOD,MAAP;AACD,CAPL,EAQKG,KAAD,IAAW;AACT,SAAOC,OAAO,CAACC,MAAR,CAAeF,KAAf,CAAP;AACD,CAVL;AAaAV,QAAQ,CAACI,YAAT,CAAsBS,QAAtB,CAA+BP,GAA/B,CACGQ,GAAD,IAAS;AACP,SAAOA,GAAP;AACD,CAHH,EAIE,MAAOC,GAAP,IAAe;AACb,QAAMC,cAAc,GAAGD,GAAG,CAACR,MAA3B;;AAEA,MAAIS,cAAc,CAACC,GAAf,KAAuB,gBAAvB,IAA2CF,GAAG,CAACF,QAAnD,EAA6D;AAC3D;AACA,QAAIE,GAAG,CAACF,QAAJ,CAAaK,MAAb,KAAwB,GAAxB,IAA+B,CAACF,cAAc,CAACG,MAAnD,EAA2D;AACzDH,MAAAA,cAAc,CAACG,MAAf,GAAwB,IAAxB;;AAEA,UAAI;AACF,cAAMC,EAAE,GAAG,MAAMpB,QAAQ,CAACqB,IAAT,CAAc,uBAAd,EAAuC;AACtDtB,UAAAA,YAAY,EAAEH,YAAY,CAAC0B,oBAAb;AADwC,SAAvC,CAAjB;AAIA,cAAM;AAAEC,UAAAA;AAAF,YAAkBH,EAAE,CAACI,IAA3B;AACA5B,QAAAA,YAAY,CAAC6B,sBAAb,CAAoCF,WAApC;AAEA,eAAOvB,QAAQ,CAACgB,cAAD,CAAf;AACD,OATD,CASE,OAAOU,MAAP,EAAe;AACf,eAAOf,OAAO,CAACC,MAAR,CAAec,MAAf,CAAP;AACD;AACF;AACF;;AAED,SAAOf,OAAO,CAACC,MAAR,CAAeG,GAAf,CAAP;AACD,CA5BH;AA+BA,eAAef,QAAf","sourcesContent":["import axios from \"axios\";\r\nimport TokenService from \"./tokenService\";\r\n\r\nimport { Base_URL } from \"../utils/baseUrlConstant\";\r\nimport { logout } from \"../actions/auth\";\r\nimport { refreshToken } from \"../actions/auth\";\r\n\r\nconst instance = axios.create({\r\n  baseURL: Base_URL,\r\n  headers: {\r\n    \"Content-Type\": \"application/json\",\r\n  },\r\n});\r\n\r\ninstance.interceptors.request.use(\r\n  (config) => {\r\n    const token = TokenService.getLocalAccessToken();\r\n    if (token) {\r\n        config.headers[\"www-authenticate\"] = 'Bearer ' + token; \r\n      }\r\n      return config;\r\n    },\r\n    (error) => {\r\n      return Promise.reject(error);\r\n    }\r\n  );\r\n\r\ninstance.interceptors.response.use(\r\n  (res) => {\r\n    return res;\r\n  },\r\n  async (err) => {\r\n    const originalConfig = err.config;\r\n\r\n    if (originalConfig.url !== \"Identity/Login\" && err.response) {\r\n      // Access Token was expired\r\n      if (err.response.status === 401 && !originalConfig._retry) {\r\n        originalConfig._retry = true;\r\n\r\n        try {\r\n          const rs = await instance.post(\"Identity/refreshToken\", {\r\n            refreshToken: TokenService.getLocalRefreshToken(),\r\n          });\r\n\r\n          const { accessToken } = rs.data;\r\n          TokenService.updateLocalAccessToken(accessToken);\r\n\r\n          return instance(originalConfig);\r\n        } catch (_error) {\r\n          return Promise.reject(_error);\r\n        }\r\n      }\r\n    }\r\n\r\n    return Promise.reject(err);\r\n  }\r\n);\r\n\r\nexport default instance;\r\n\r\n"]},"metadata":{},"sourceType":"module"}