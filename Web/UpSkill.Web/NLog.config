<?xml version="1.0" encoding="utf-8" ?>

<nlog xmlns="http://www.nlog-project.org/schemas/NLog.xsd"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      autoReload="true"
      throwExceptions="false">

  <variable name="LogDirectory" value="${gdc:LogDirectory}"></variable>>

  <targets>

    <target name="logfile"
            xsi:type="File"
            fileName="${LogDirectory}/${shortdate}.log"
            layout="${uppercase:${level}}: ${message} at ${date:format=HH\:mm\:ss dddd, dd MMMM yyyy} ${machinename} ${logger}" />

    <target name="database"
            xsi:type="Database"
            connectionString="Server=tcp:ourupskill.database.windows.net,1433;Initial Catalog=upskill;Persist Security Info=False;User ID=mamkamu;Password=OgiELud123*;MultipleActiveResultSets=False;Encrypt=True;TrustServerCertificate=False;Connection Timeout=30;">

      <dbProvider> Microsoft.Data.SqlClient</dbProvider>

      <commandText>
        "INSERT INTO Logs (date,level,message,machinename,logger)
        VALUES (@date,@level,@message,@machinename,@logger)"
      </commandText>

      <parameter name="@date" layout="${longdate}"/>
      <parameter name="@level" layout="${level}" />
      <parameter name="@message" layout="${message}"/>
      <parameter name="@machinename" layout="${machinename}"/>
      <parameter name="@logger" layout="${logger}"/>
  </target>
  
  </targets>

  <rules>
    <logger name="Microsoft.*" minlevel="Trace" writeTo="blackHole" final="true" />
    <logger name="*" minlevel="Info" writeTo="logfile"/>
    <logger name="*" minlevel="Info" writeTo="database"/>
  </rules>

</nlog>
