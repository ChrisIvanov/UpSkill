<?xml version="1.0" encoding="utf-8" ?>

<nlog xmlns="http://www.nlog-project.org/schemas/NLog.xsd"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      autoReload="true"
      throwExceptions="false">

  <variable name="LogDirectory" value="${gdc:LogDirectory}"></variable>>

  <targets>

    <target name="logfile"
            xsi:type="File"
            fileName="${LogDirectory}/${shortdate}.log"
            layout="${uppercase:${level}}: ${message} at ${date:format=HH\:mm\:ss dddd, dd MMMM yyyy}" />

    <target name="database"
            xsi:type="Database"
            connectionString="${configsetting:item=ConnectionStrings.DefaultConnection}"
            dbProvider="Microsoft.Data.SqlClient.SqlConnection,Microsoft.Data.SqlClien"
            commandText="INSERT INTO Logs(level,date,message,machineName,logger)
            values (@level,@date,@message,@machineName,@logger)"/>

    <parameter name="level" layout="${level}" />
    <parameter name="date" layout="${longdate}"/>
    <parameter name="message" layout="${message}"/>
    <parameter name="machineName" layout="${machinename}"/>
    <parameter name="logger" layout="${logger}"/>

  </targets>

  <rules>
    <logger name="Microsoft.*" minlevel="Trace" writeTo="blackHole" final="true" />
    <logger name="*" minlevel="Info" writeTo="logfile"/>
    <logger name="*" minlevel="Info" writeTo="database"/>
  </rules>

</nlog>
